From 9400db2b6059360a2c5a8017cb0cbe7e73d2fec5 Mon Sep 17 00:00:00 2001
From: Rusty Bird <rustybird@openmailbox.org>
Date: Mon, 22 Feb 2016 16:27:41 +0000
Subject: [bionic] Add net.dnscache property, like BIONIC_DNSCACHE env variable

Change-Id: I6fe2f21d063a74e6650565564af151858daf5c32
---
 libc/dns/resolv/res_cache.c | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/libc/dns/resolv/res_cache.c b/libc/dns/resolv/res_cache.c
index 5a78450..ccd6450 100644
--- a/libc/dns/resolv/res_cache.c
+++ b/libc/dns/resolv/res_cache.c
@@ -98,11 +98,12 @@
  *     is too short to accomodate the cached result.
  */
 
-/* the name of an environment variable that will be checked the first time
- * this code is called if its value is "0", then the resolver cache is
- * disabled.
+/* the name of an environment variable and a property that will be checked
+ * whenever the cache is (re)initialized. If either value is "0", then the
+ * resolver cache is disabled.
  */
 #define  CONFIG_ENV  "BIONIC_DNSCACHE"
+#define  CONFIG_PROP "net.dnscache"
 
 /* default number of entries kept in the cache. This value has been
  * determined by browsing through various sites and counting the number
@@ -1806,8 +1807,10 @@ static void
 _res_cache_init(void)
 {
     const char*  env = getenv(CONFIG_ENV);
+    char prop[PROP_VALUE_MAX];
 
-    if (env && atoi(env) == 0) {
+    if ((env && atoi(env) == 0) ||
+        (__system_property_get(CONFIG_PROP, prop) && atoi(prop) == 0)) {
         /* the cache is disabled */
         return;
     }
-- 
2.5.0

